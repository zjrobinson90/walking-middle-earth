<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journey Through Middle-earth</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.css" />
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            font-family: monospace;
        }
        #map {
            width: 100%;
            height: 80vh;
        }
        #debug {
            height: 20vh;
            overflow-y: auto;
            padding: 10px;
            background: #f5f5f5;
            font-size: 12px;
        }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="debug"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.js"></script>
    <script>
        // Debug logging function
        function log(message, type = 'info') {
            const debug = document.getElementById('debug');
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            debug.insertBefore(entry, debug.firstChild);
            console.log(message);
        }

        // Test specific tile URLs
        async function testTile(z, x, y) {
            const url = `https://zjrobinson90.github.io/walking-middle-earth/tiles/${z}/${x}/${y}.jpg`;
            try {
                const response = await fetch(url);
                if (response.ok) {
                    log(`✓ Tile exists: ${url}`, 'success');
                } else {
                    log(`✗ Tile failed (${response.status}): ${url}`, 'error');
                }
            } catch (error) {
                log(`✗ Error loading tile: ${url} - ${error}`, 'error');
            }
        }

        // Test some known valid tiles
        const testTiles = [
            [0, 0, 0],
            [0, 0, 1],
            [0, 1, 0],
            [0, 1, 1],
            [1, 0, 0]
        ];

        log('Starting tile tests...');
        testTiles.forEach(([z, x, y]) => testTile(z, x, y));

        // Initialize map
        const map = L.map('map', {
            crs: L.CRS.Simple,
            minZoom: 0,
            maxZoom: 3
        });

        L.TileLayer.BoundedTiles = L.TileLayer.extend({
            getTileUrl: function(coords) {
                const url = `https://zjrobinson90.github.io/walking-middle-earth/tiles/${coords.z}/${coords.x}/${coords.y}.jpg`;
                log(`Requesting tile: ${url}`);
                return url;
            },
            createTile: function(coords, done) {
                const tile = document.createElement('img');
                tile.src = this.getTileUrl(coords);
                tile.alt = '';
                
                tile.onload = () => {
                    log(`✓ Loaded tile: z=${coords.z}, x=${coords.x}, y=${coords.y}`, 'success');
                    done(null, tile);
                };
                
                tile.onerror = () => {
                    log(`✗ Failed to load tile: z=${coords.z}, x=${coords.x}, y=${coords.y}`, 'error');
                    done(null, tile);
                };
                
                return tile;
            }
        });

        // Add tile layer
        new L.TileLayer.BoundedTiles('', {
            minZoom: 0,
            maxZoom: 3,
            tileSize: 256,
            noWrap: true
        }).addTo(map);

        // Set initial view
        const tileSize = 256;
        map.setView([tileSize, tileSize], 0);

        // Add map event logging
        map.on('zoomend', () => {
            const zoom = map.getZoom();
            const center = map.getCenter();
            log(`Map zoom: ${zoom}, center: [${center.lat.toFixed(0)}, ${center.lng.toFixed(0)}]`);
        });
    </script>
</body>
</html>
